;; PgBouncer configuration for SmartSports Rwanda
;; Optimized for high-scale ticketing system with 10M+ concurrent users

[databases]
; Primary database
smartsports_rwanda = host=localhost port=5432 dbname=smartsports_rwanda user=postgres password=smartsports2024

; Read replica (if available)
smartsports_rwanda_read = host=localhost port=5433 dbname=smartsports_rwanda user=postgres password=smartsports2024

; Test database
smartsports_rwanda_test = host=localhost port=5432 dbname=smartsports_rwanda_test user=postgres password=smartsports2024

[pgbouncer]
; Administrative settings
listen_addr = 0.0.0.0
listen_port = 6432
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt
admin_users = postgres, admin
stats_users = postgres, admin, monitoring

; Pool settings optimized for high concurrency
pool_mode = transaction
max_client_conn = 2000
default_pool_size = 100
min_pool_size = 10
reserve_pool_size = 20
reserve_pool_timeout = 5

; Connection limits per database
max_db_connections = 200
max_user_connections = 100

; Timeouts (in seconds)
server_reset_query = DISCARD ALL
server_check_delay = 30
server_check_query = SELECT 1
server_lifetime = 3600
server_idle_timeout = 600
client_idle_timeout = 0
client_login_timeout = 60
autodb_idle_timeout = 3600

; Query timeouts
query_timeout = 30
query_wait_timeout = 120
cancel_wait_timeout = 10

; Memory settings
listen_backlog = 128
sbuf_loopcnt = 5
suspend_timeout = 10
tcp_defer_accept = 0
tcp_socket_buffer = 0
tcp_keepalive = 1
tcp_keepcnt = 3
tcp_keepidle = 600
tcp_keepintvl = 30

; Logging
log_connections = 1
log_disconnections = 1
log_pooler_errors = 1
syslog = 0
syslog_facility = daemon
syslog_ident = pgbouncer

; Verbose logging (disable in production)
verbose = 0

; Application name
application_name_add_host = 1

; DNS settings
dns_max_ttl = 15
dns_nxdomain_ttl = 15
dns_zone_check_period = 0

; Security
ignore_startup_parameters = extra_float_digits

; Performance tuning
server_round_robin = 0
disable_pqexec = 0
client_tls_sslmode = disable
server_tls_sslmode = disable

; Statistics
stats_period = 60

; Online restart
so_reuseport = 1

; Prepared statements
max_prepared_statements = 100

; Unix socket (optional)
unix_socket_dir = /tmp
unix_socket_mode = 0777
unix_socket_group = postgres
